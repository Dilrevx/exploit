import hashlib
from itertools import product
import re
import string
import requests


answerUrl = "https://app.toutiao.com?url=http%3A%2F%2F47.121.200.18"

questionUrl = "http://35.221.152.10:23334/"


def crackPow(challStr: str):
    # fmtStr = "PoW Challenge: SHA256(solution + 'challenge') must start with 'prefix'."
    prefix = "000000"
    charSet = string.digits + string.ascii_lowercase
    searchSpace = (
        "".join(char) for char in product(charSet, repeat=64 - len(challStr))
    )

    for solution in searchSpace:
        hash = hashlib.sha256((challStr + solution).encode()).hexdigest()
        if hash.startswith(prefix):
            print(f"Solution found: {solution}")
            print(f"Hash: {hash}")
            return solution


def main():
    session = requests.session()

    html = session.get(questionUrl).text

    """
    demo: Proof of work: sha256('Jn4zPlGJ + 
    """

    regexp = "sha256\('(.+?) "
    challStr = re.search(regexp, html).group(1)
    # challStr = "dFHfd93T"

    print(html)
    print(challStr)
    solution = crackPow(challStr)
    print(solution)

    req = session.post(questionUrl, data={"pow_answer": solution, "url": answerUrl})

    print(req.text)


main()
